!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e():"function"==typeof define&&define.amd?define(e):e()}(0,function(){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(e){var i="object"===("undefined"==typeof self?"undefined":t(self))&&self.self===self&&self||"object"===("undefined"==typeof global?"undefined":t(global))&&global.global===global&&global;if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],function(t,n,r){i.Backbone=e(i,r,t,n)});else if("undefined"!=typeof exports){var n,r=require("underscore");try{n=require("jquery")}catch(t){}e(i,exports,r,n)}else i.Backbone=e(i,{},i._,i.jQuery||i.Zepto||i.ender||i.$)}(function(e,i,n,r){var s=e.Backbone,o=Array.prototype.slice;i.VERSION="1.3.3",i.$=r,i.noConflict=function(){return e.Backbone=s,this},i.emulateHTTP=!1,i.emulateJSON=!1;var a,u=i.Events={},l=/\s+/,h=function e(i,r,s,o,a){var u,h=0;if(s&&"object"===(void 0===s?"undefined":t(s))){void 0!==o&&"context"in a&&void 0===a.context&&(a.context=o);for(u=n.keys(s);h<u.length;h++)r=e(i,r,u[h],s[u[h]],a)}else if(s&&l.test(s))for(u=s.split(l);h<u.length;h++)r=i(r,u[h],o,a);else r=i(r,s,o,a);return r};u.on=function(t,e,i){(this._events=h(c,this._events||{},t,e,{context:i,ctx:this,listening:a}),a)&&((this._listeners||(this._listeners={}))[a.id]=a,a.interop=!1);return this},u.listenTo=function(t,e,i){if(!t)return this;var r=t._listenId||(t._listenId=n.uniqueId("l")),s=this._listeningTo||(this._listeningTo={}),o=a=s[r];o||(this._listenId||(this._listenId=n.uniqueId("l")),o=a=s[r]=new y(this,t));var u=d(t,e,i,this);if(a=void 0,u)throw u;return o.interop&&o.on(e,i),this};var c=function(t,e,i,n){if(i){var r=t[e]||(t[e]=[]),s=n.context,o=n.ctx,a=n.listening;a&&a.count++,r.push({callback:i,context:s,ctx:s||o,listening:a})}return t},d=function(t,e,i,n){try{t.on(e,i,n)}catch(t){return t}};u.off=function(t,e,i){return this._events?(this._events=h(f,this._events,t,e,{context:i,listeners:this._listeners}),this):this},u.stopListening=function(t,e,i){var r=this._listeningTo;if(!r)return this;for(var s=t?[t._listenId]:n.keys(r),o=0;o<s.length;o++){var a=r[s[o]];if(!a)break;a.obj.off(e,i,this),a.interop&&a.off(e,i)}return n.isEmpty(r)&&(this._listeningTo=void 0),this};var f=function(t,e,i,r){if(t){var s,o=r.context,a=r.listeners,u=0;if(e||o||i){for(s=e?[e]:n.keys(t);u<s.length;u++){var l=t[e=s[u]];if(!l)break;for(var h=[],c=0;c<l.length;c++){var d=l[c];if(i&&i!==d.callback&&i!==d.callback._callback||o&&o!==d.context)h.push(d);else{var f=d.listening;f&&f.off(e,i)}}h.length?t[e]=h:delete t[e]}return t}for(s=n.keys(a);u<s.length;u++)a[s[u]].cleanup()}};u.once=function(t,e,i){var n=h(p,{},t,e,this.off.bind(this));return"string"==typeof t&&null==i&&(e=void 0),this.on(n,e,i)},u.listenToOnce=function(t,e,i){var n=h(p,{},e,i,this.stopListening.bind(this,t));return this.listenTo(t,n)};var p=function(t,e,i,r){if(i){var s=t[e]=n.once(function(){r(e,s),i.apply(this,arguments)});s._callback=i}return t};u.trigger=function(t){if(!this._events)return this;for(var e=Math.max(0,arguments.length-1),i=Array(e),n=0;n<e;n++)i[n]=arguments[n+1];return h(v,this._events,t,void 0,i),this};var v=function(t,e,i,n){if(t){var r=t[e],s=t.all;r&&s&&(s=s.slice()),r&&g(r,n),s&&g(s,[e].concat(n))}return t},g=function(t,e){var i,n=-1,r=t.length,s=e[0],o=e[1],a=e[2];switch(e.length){case 0:for(;++n<r;)(i=t[n]).callback.call(i.ctx);return;case 1:for(;++n<r;)(i=t[n]).callback.call(i.ctx,s);return;case 2:for(;++n<r;)(i=t[n]).callback.call(i.ctx,s,o);return;case 3:for(;++n<r;)(i=t[n]).callback.call(i.ctx,s,o,a);return;default:for(;++n<r;)(i=t[n]).callback.apply(i.ctx,e);return}},y=function(t,e){this.id=t._listenId,this.listener=t,this.obj=e,this.interop=!0,this.count=0,this._events=void 0};y.prototype.on=u.on,y.prototype.off=function(t,e){var i;this.interop?(this._events=h(f,this._events,t,e,{context:void 0,listeners:void 0}),i=!this._events):(this.count--,i=0===this.count),i&&this.cleanup()},y.prototype.cleanup=function(){delete this.listener._listeningTo[this.obj._listenId],this.interop||delete this.obj._listeners[this.id]},u.bind=u.on,u.unbind=u.off,n.extend(i,u);var m=i.Model=function(t,e){var i=t||{};e||(e={}),this.preinitialize.apply(this,arguments),this.cid=n.uniqueId(this.cidPrefix),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(i=this.parse(i,e)||{});var r=n.result(this,"defaults");i=n.defaults(n.extend({},r,i),r),this.set(i,e),this.changed={},this.initialize.apply(this,arguments)};n.extend(m.prototype,u,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",preinitialize:function(){},initialize:function(){},toJSON:function(t){return n.clone(this.attributes)},sync:function(){return i.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return n.escape(this.get(t))},has:function(t){return null!=this.get(t)},matches:function(t){return!!n.iteratee(t,this)(this.attributes)},set:function(e,i,r){if(null==e)return this;var s;if("object"===(void 0===e?"undefined":t(e))?(s=e,r=i):(s={})[e]=i,r||(r={}),!this._validate(s,r))return!1;var o=r.unset,a=r.silent,u=[],l=this._changing;this._changing=!0,l||(this._previousAttributes=n.clone(this.attributes),this.changed={});var h=this.attributes,c=this.changed,d=this._previousAttributes;for(var f in s)i=s[f],n.isEqual(h[f],i)||u.push(f),n.isEqual(d[f],i)?delete c[f]:c[f]=i,o?delete h[f]:h[f]=i;if(this.idAttribute in s&&(this.id=this.get(this.idAttribute)),!a){u.length&&(this._pending=r);for(var p=0;p<u.length;p++)this.trigger("change:"+u[p],this,h[u[p]],r)}if(l)return this;if(!a)for(;this._pending;)r=this._pending,this._pending=!1,this.trigger("change",this,r);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,n.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var i in this.attributes)e[i]=void 0;return this.set(e,n.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!n.isEmpty(this.changed):n.has(this.changed,t)},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&n.clone(this.changed);var e,i=this._changing?this._previousAttributes:this.attributes,r={};for(var s in t){var o=t[s];n.isEqual(i[s],o)||(r[s]=o,e=!0)}return!!e&&r},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(t){var e=this,i=(t=n.extend({parse:!0},t)).success;return t.success=function(n){var r=t.parse?e.parse(n,t):n;if(!e.set(r,t))return!1;i&&i.call(t.context,e,n,t),e.trigger("sync",e,n,t)},q(this,t),this.sync("read",this,t)},save:function(e,i,r){var s;null==e||"object"===(void 0===e?"undefined":t(e))?(s=e,r=i):(s={})[e]=i;var o=(r=n.extend({validate:!0,parse:!0},r)).wait;if(s&&!o){if(!this.set(s,r))return!1}else if(!this._validate(s,r))return!1;var a=this,u=r.success,l=this.attributes;r.success=function(t){a.attributes=l;var e=r.parse?a.parse(t,r):t;if(o&&(e=n.extend({},s,e)),e&&!a.set(e,r))return!1;u&&u.call(r.context,a,t,r),a.trigger("sync",a,t,r)},q(this,r),s&&o&&(this.attributes=n.extend({},l,s));var h=this.isNew()?"create":r.patch?"patch":"update";"patch"!==h||r.attrs||(r.attrs=s);var c=this.sync(h,this,r);return this.attributes=l,c},destroy:function(t){var e=this,i=(t=t?n.clone(t):{}).success,r=t.wait,s=function(){e.stopListening(),e.trigger("destroy",e,e.collection,t)};t.success=function(n){r&&s(),i&&i.call(t.context,e,n,t),e.isNew()||e.trigger("sync",e,n,t)};var o=!1;return this.isNew()?n.defer(t.success):(q(this,t),o=this.sync("delete",this,t)),r||s(),o},url:function(){var t=n.result(this,"urlRoot")||n.result(this.collection,"url")||P();if(this.isNew())return t;var e=this.get(this.idAttribute);return t.replace(/[^\/]$/,"$&/")+encodeURIComponent(e)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},n.extend({},t,{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=n.extend({},this.attributes,t);var i=this.validationError=this.validate(t,e)||null;return!i||(this.trigger("invalid",this,i,n.extend(e,{validationError:i})),!1)}});var _=i.Collection=function(t,e){e||(e={}),this.preinitialize.apply(this,arguments),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,n.extend({silent:!0},e))},b={add:!0,remove:!0,merge:!0},x={add:!0,remove:!1},I=function(t,e,i){i=Math.min(Math.max(i,0),t.length);var n,r=Array(t.length-i),s=e.length;for(n=0;n<r.length;n++)r[n]=t[n+i];for(n=0;n<s;n++)t[n+i]=e[n];for(n=0;n<r.length;n++)t[n+s+i]=r[n]};n.extend(_.prototype,u,{model:m,preinitialize:function(){},initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return i.sync.apply(this,arguments)},add:function(t,e){return this.set(t,n.extend({merge:!1},e,x))},remove:function(t,e){e=n.extend({},e);var i=!n.isArray(t);t=i?[t]:t.slice();var r=this._removeModels(t,e);return!e.silent&&r.length&&(e.changes={added:[],merged:[],removed:r},this.trigger("update",this,e)),i?r[0]:r},set:function(t,e){if(null!=t){(e=n.extend({},b,e)).parse&&!this._isModel(t)&&(t=this.parse(t,e)||[]);var i=!n.isArray(t);t=i?[t]:t.slice();var r=e.at;null!=r&&(r=+r),r>this.length&&(r=this.length),r<0&&(r+=this.length+1);var s,o,a=[],u=[],l=[],h=[],c={},d=e.add,f=e.merge,p=e.remove,v=!1,g=this.comparator&&null==r&&!1!==e.sort,y=n.isString(this.comparator)?this.comparator:null;for(o=0;o<t.length;o++){s=t[o];var m=this.get(s);if(m){if(f&&s!==m){var _=this._isModel(s)?s.attributes:s;e.parse&&(_=m.parse(_,e)),m.set(_,e),l.push(m),g&&!v&&(v=m.hasChanged(y))}c[m.cid]||(c[m.cid]=!0,a.push(m)),t[o]=m}else d&&(s=t[o]=this._prepareModel(s,e))&&(u.push(s),this._addReference(s,e),c[s.cid]=!0,a.push(s))}if(p){for(o=0;o<this.length;o++)c[(s=this.models[o]).cid]||h.push(s);h.length&&this._removeModels(h,e)}var x=!1,T=!g&&d&&p;if(a.length&&T?(x=this.length!==a.length||n.some(this.models,function(t,e){return t!==a[e]}),this.models.length=0,I(this.models,a,0),this.length=this.models.length):u.length&&(g&&(v=!0),I(this.models,u,null==r?this.length:r),this.length=this.models.length),v&&this.sort({silent:!0}),!e.silent){for(o=0;o<u.length;o++)null!=r&&(e.index=r+o),(s=u[o]).trigger("add",s,this,e);(v||x)&&this.trigger("sort",this,e),(u.length||h.length||l.length)&&(e.changes={added:u,removed:h,merged:l},this.trigger("update",this,e))}return i?t[0]:t}},reset:function(t,e){e=e?n.clone(e):{};for(var i=0;i<this.models.length;i++)this._removeReference(this.models[i],e);return e.previousModels=this.models,this._reset(),t=this.add(t,n.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,n.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t)},unshift:function(t,e){return this.add(t,n.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t)},slice:function(){return o.apply(this.models,arguments)},get:function(t){if(null!=t)return this._byId[t]||this._byId[this.modelId(this._isModel(t)?t.attributes:t)]||t.cid&&this._byId[t.cid]},has:function(t){return null!=this.get(t)},at:function(t){return t<0&&(t+=this.length),this.models[t]},where:function(t,e){return this[e?"find":"filter"](t)},findWhere:function(t){return this.where(t,!0)},sort:function(t){var e=this.comparator;if(!e)throw new Error("Cannot sort a set without a comparator");t||(t={});var i=e.length;return n.isFunction(e)&&(e=e.bind(this)),1===i||n.isString(e)?this.models=this.sortBy(e):this.models.sort(e),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return this.map(t+"")},fetch:function(t){var e=(t=n.extend({parse:!0},t)).success,i=this;return t.success=function(n){var r=t.reset?"reset":"set";i[r](n,t),e&&e.call(t.context,i,n,t),i.trigger("sync",i,n,t)},q(this,t),this.sync("read",this,t)},create:function(t,e){var i=(e=e?n.clone(e):{}).wait;if(!(t=this._prepareModel(t,e)))return!1;i||this.add(t,e);var r=this,s=e.success;return e.success=function(t,e,n){i&&r.add(t,n),s&&s.call(n.context,t,e,n)},t.save(null,e),t},parse:function(t,e){return t},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(t){return t[this.model.prototype.idAttribute||"id"]},values:function(){return new w(this,k)},keys:function(){return new w(this,A)},entries:function(){return new w(this,E)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(this._isModel(t))return t.collection||(t.collection=this),t;(e=e?n.clone(e):{}).collection=this;var i=new this.model(t,e);return i.validationError?(this.trigger("invalid",this,i.validationError,e),!1):i},_removeModels:function(t,e){for(var i=[],n=0;n<t.length;n++){var r=this.get(t[n]);if(r){var s=this.indexOf(r);this.models.splice(s,1),this.length--,delete this._byId[r.cid];var o=this.modelId(r.attributes);null!=o&&delete this._byId[o],e.silent||(e.index=s,r.trigger("remove",r,this,e)),i.push(r),this._removeReference(r,e)}}return i},_isModel:function(t){return t instanceof m},_addReference:function(t,e){this._byId[t.cid]=t;var i=this.modelId(t.attributes);null!=i&&(this._byId[i]=t),t.on("all",this._onModelEvent,this)},_removeReference:function(t,e){delete this._byId[t.cid];var i=this.modelId(t.attributes);null!=i&&delete this._byId[i],this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,n){if(e){if(("add"===t||"remove"===t)&&i!==this)return;if("destroy"===t&&this.remove(e,n),"change"===t){var r=this.modelId(e.previousAttributes()),s=this.modelId(e.attributes);r!==s&&(null!=r&&delete this._byId[r],null!=s&&(this._byId[s]=e))}}this.trigger.apply(this,arguments)}});var T="function"==typeof Symbol&&Symbol.iterator;T&&(_.prototype[T]=_.prototype.values);var w=function(t,e){this._collection=t,this._kind=e,this._index=0},k=1,A=2,E=3;T&&(w.prototype[T]=function(){return this}),w.prototype.next=function(){if(this._collection){if(this._index<this._collection.length){var t,e=this._collection.at(this._index);if(this._index++,this._kind===k)t=e;else{var i=this._collection.modelId(e.attributes);t=this._kind===A?i:[i,e]}return{value:t,done:!1}}this._collection=void 0}return{value:void 0,done:!0}};var S=function(t,e,i,n){switch(e){case 1:return function(){return t[i](this[n])};case 2:return function(e){return t[i](this[n],e)};case 3:return function(e,r){return t[i](this[n],M(e,this),r)};case 4:return function(e,r,s){return t[i](this[n],M(e,this),r,s)};default:return function(){var e=o.call(arguments);return e.unshift(this[n]),t[i].apply(t,function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}(e))}}},j=function(t,e,i,r){n.each(i,function(i,n){e[n]&&(t.prototype[n]=S(e,i,n,r))})},M=function(t,e){return n.isFunction(t)?t:n.isObject(t)&&!e._isModel(t)?O(t):n.isString(t)?function(e){return e.get(t)}:t},O=function(t){var e=n.matches(t);return function(t){return e(t.attributes)}};n.each([[_,{forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3},"models"],[m,{keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1},"attributes"]],function(t){var e=t[0],i=t[1],r=t[2];e.mixin=function(t){var i=n.reduce(n.functions(t),function(t,e){return t[e]=0,t},{});j(e,t,i,r)},j(e,n,i,r)}),i.sync=function(t,e,r){var s=N[t];n.defaults(r||(r={}),{emulateHTTP:i.emulateHTTP,emulateJSON:i.emulateJSON});var o={type:s,dataType:"json"};if(r.url||(o.url=n.result(e,"url")||P()),null!=r.data||!e||"create"!==t&&"update"!==t&&"patch"!==t||(o.contentType="application/json",o.data=JSON.stringify(r.attrs||e.toJSON(r))),r.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{}),r.emulateHTTP&&("PUT"===s||"DELETE"===s||"PATCH"===s)){o.type="POST",r.emulateJSON&&(o.data._method=s);var a=r.beforeSend;r.beforeSend=function(t){if(t.setRequestHeader("X-HTTP-Method-Override",s),a)return a.apply(this,arguments)}}"GET"===o.type||r.emulateJSON||(o.processData=!1);var u=r.error;r.error=function(t,e,i){r.textStatus=e,r.errorThrown=i,u&&u.call(r.context,t,e,i)};var l=r.xhr=i.ajax(n.extend(o,r));return e.trigger("request",e,l,r),l};var N={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};i.ajax=function(){return i.$.ajax.apply(i.$,arguments)};m.extend=_.extend=function(t,e){var i,r=this;return i=t&&n.has(t,"constructor")?t.constructor:function(){return r.apply(this,arguments)},n.extend(i,r,e),i.prototype=n.create(r.prototype,t),i.prototype.constructor=i,i.__super__=r.prototype,i};var P=function(){throw new Error('A "url" property or function must be specified')},q=function(t,e){var i=e.error;e.error=function(n){i&&i.call(e.context,t,n,e),t.trigger("error",t,n,e)}};return i})});
